import{C as fe}from"./confirm-cfbddac4.js";import{d as T,B as Re,w as ye,o as i,c as m,a as o,t as _,n as K,u as w,s as ue,F as W,e as ie,x as U,_ as Se,C as Le,b as c,D as me,f as q,E as we,G as ge,H as re,g as xe,i as s,j as u,k as z,y as he,I as be,m as D}from"./index-351c9552.js";import{f as Ee}from"./filter-835e61cc.js";/* empty css                                                                        */const Ce="/assets/default-701aedeb.svg",De="/assets/active-a72c716f.svg",Ie="/assets/completed-fb9caa67.svg",Be="/assets/overdue-ae9ff192.svg",Ne={class:"text-dark-800 text-xs whitespace-nowrap"},je={class:"text-dark-900 font-bold"},Te={class:"w-10 h-10 flex-shrink-0"},Pe=["src"],Fe={__name:"LoanInfoCard",props:{data:{type:Object,required:!0,default:()=>({title:"",value:"0",type:"default",icon:""})}},setup(I){const y=I;console.log(y.data);const S=T(()=>({default:{border:"border-[#E7E8E7]",bg:"bg-[#F2F1F1]"},active:{border:"border-[#D3F0FF]",bg:"bg-[#EBF6FC]"},completed:{border:"border-[#BEF0C9]",bg:"bg-[#E7FBEF]"},overdue:{border:"border-[#FFD1CE]",bg:"bg-[#FFEDEC]"}})[y.data.type]);return(d,L)=>{const x=Re("ripple");return ye((i(),m("div",{class:K(["p-ripple w-full rounded-2xl p-3 gap-2 border flex items-center justify-between gap-2",[w(S).border,w(S).bg]])},[o("div",null,[o("h6",Ne,_(I.data&&I.data.title),1),o("span",je,_(I.data&&I.data.value&&I.data.value.toLocaleString()),1)]),o("div",Te,[o("img",{src:I.data&&I.data.icon,alt:"",class:"w-full object-contain"},null,8,Pe)])],2)),[[x]])}}},qe={class:"w-full sm:w-10/12 mx-auto place-content-center grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 justify-center gap-2 md:gap-4"},Ve={__name:"LoanInfoCards",setup(I){const y=ue(),{query:S}=y,d=T(()=>y.getLoanReport),L=T(()=>[{title:"Total Loans",value:d.value&&d.value.totalLoans,type:"default",icon:Ce},{title:"Active Loans",value:d.value&&d.value.activeLoans,type:"active",icon:De},{title:"Cleared",value:d.value&&d.value.clearedLoans,type:"default",icon:Ce},{title:"Completed",value:d.value&&d.value.completedLoans,type:"completed",icon:Ie},{title:"Overdues",value:d.value&&d.value.overdues,type:"overdue",icon:Be}]);return(async(p=!0)=>{try{const f=await S({endpoint:"QueryLoanReport",storeKey:"loanReport"});console.log(f)}catch(f){console.log(f.message)}})(),(p,f)=>(i(),m("div",qe,[(i(!0),m(W,null,ie(w(L),(B,N)=>(i(),U(Fe,{key:N,data:B},null,8,["data"]))),128))]))}},Oe={emits:["filter"],data:()=>({dropdownStyle:"top-14",filterIcon:Ee}),setup(I,{emit:y}){ue();const S=Le(),d=c(""),L=c(!1),x=T(()=>S.query.type?S.query.type:"current_loan"),p=me({paging:{limit:1e3,skip:0,search:""},filter:{type:null,status:null,overdue:void 0},sort:{createdAt:void 0,durationEndedAt:void 0,loanAmountApplied:void 0,creditReport:void 0,companyId:{company:{companyName:1}}}}),f=T(()=>[{name:"All",value:"all",type:"all",show:!0},{name:"A - Z",value:"companyName",type:"name",order:1,show:!0},{name:"Z - A",value:"companyName",type:"name",order:-1,show:!0},{name:"Active",value:"APPROVED",type:"status",show:x.value!=="new_request"},{name:"Overdue",value:!0,type:"overdue",show:x.value!=="new_request"},{name:"Completed",value:"COMPLETED",type:"status",show:x.value!=="new_request"},{name:"Pending",value:"PENDING",type:"status",show:x.value!=="new_request"},{name:"Rejected",value:"DECLINED",type:"status",show:x.value!=="new_request"},{name:"Cleared",value:"COMPLETED",type:"status",show:x.value!=="new_request"},{name:"Enterprise",value:"ENTERPRISE_LOAN",type:"type",show:!0},{name:"Payroll Cover",value:"PAYROLL_COVER",type:"type",show:!0},{name:"Credit Score",value:"creditScore",type:"order",order:1,show:x.value=="new_request"},{name:"Earliest Due Date",value:"durationEndedAt",type:"order",order:1,show:!0},{name:"Highest to Lowest",value:"loanAmountApplied",type:"order",order:1,show:!0},{name:"Lowest to Highest",value:"loanAmountApplied",type:"order",order:-1,show:!0}]),B=async k=>{k.type=="status"||k.type=="type"||k.type=="overdue"?p.filter[k.type]=k.value:k.type=="all"?(N(),p.sort.createdAt=-1):k.type=="order"?(N(),p.sort[k.value]=k.order):k.type=="name"&&(N(),p.sort.companyId.company[k.value]=k.order),y("filter",p),d.value=k.name,L.value=!1},N=()=>{p.filter={type:null,status:null,overdue:void 0},p.sort={createdAt:void 0,durationEndedAt:void 0,loanAmountApplied:void 0,creditReport:void 0,companyId:{company:{companyName:1}}}};return{toggleFilter:L,activeFilter:d,filterFuction:B,filterOptions:f}},mounted(){window.addEventListener("scroll",this.checkDropdownPosition)},beforeDestroy(){window.removeEventListener("scroll",this.checkDropdownPosition)},methods:{checkDropdownPosition(){let y=this.$el.getBoundingClientRect();y.height;let S=y.top,d=y.bottom;S<0?this.dropdownStyle="top-14":d>420?this.dropdownStyle="bottom-14":this.dropdownStyle="top-14"}}},ze={class:"relative"},Ue={class:"flex items-center gap-1"},He=o("span",{class:"text-dark-700"},"Filter",-1),Ge={key:0,class:"w-fit truncate w-fit font-medium text-sm text-dark-900"},Ke={class:"w-6"},Me=["src"],Ye=["onClick"],Qe={class:"flex items-center gap-3 cursor-pointer px-4 py-2 hover:bg-primary-hover hover:text-white"};function Ze(I,y,S,d,L,x){return i(),m(W,null,[o("div",ze,[o("div",{onClick:y[0]||(y[0]=p=>d.toggleFilter=!0),class:"flex items-center justify-between gap-2 rounded-lg bg-newGrey p-2 cursor-pointer"},[o("div",Ue,[He,d.activeFilter?(i(),m("span",Ge,_(d.activeFilter),1)):q("",!0)]),o("div",Ke,[o("img",{src:I.filterIcon,alt:""},null,8,Me)])]),d.toggleFilter?(i(),m("div",{key:0,class:K([I.dropdownStyle,"absolute h-56 w-52 rounded-xl overflow-hidden overflow-y-auto right-0 shadow-lg bg-white flex flex-col text-sm"]),style:{"z-index":"2"}},[(i(!0),m(W,null,ie(d.filterOptions,p=>ye((i(),m("div",{class:"border-b last:border-b-0",key:p.name,onClick:f=>d.filterFuction(p)},[o("div",Qe,[o("span",null,_(p.name),1)])],8,Ye)),[[we,p.show]])),128))],2)):q("",!0)]),o("div",{onClick:y[1]||(y[1]=p=>d.toggleFilter=!1),class:K([d.toggleFilter?"":"pointer-events-none","bg-transparent fixed inset-0"])},null,2)],64)}const Je=Se(Oe,[["render",Ze]]),We={class:"flex flex-col gap-4"},Xe={class:"flex items-center justify-between"},et=o("h2",{class:"text-xl"},"Loans",-1),tt=["onClick"],at={class:"applicant-avatar"},ot=["src"],lt={key:1,class:"w-full h-full bg-primary flex items-center justify-center text-white font-medium;"},nt={class:"applicant-name"},st=["onClick"],rt=["onClick"],it=["onClick"],ct=["onClick"],ut=["onClick"],dt=["onClick"],vt=["onClick"],pt=o("i",{class:"pi pi-ellipsis-v text-dark-400 cursor-pointer"},null,-1),ft=[pt],mt=["onClick"],yt={class:"grid grid-cols-2 gap-2"},gt={__name:"CurrentLoan",props:{searchText:{type:String,default:""}},emits:["selected"],setup(I,{emit:y}){const S=I,d=ue(),{query:L,mutate:x}=d,p=ge(),f=he(),{formatAmount:B,formatDate:N,initials:k}=be,j=T(()=>S.searchText),b=c(!1),E=c(!1),P=c(!1),M=c(null),g=c(null),h=c(null),R=T(()=>[{title:"View",show:!0,iconClass:"pi pi-eye",color:"text-[#11453B]",action(t){g.value=null,J(t)}},{title:"Blacklist",show:!0,iconClass:"pi pi-exclamation-triangle",color:"text-[#EA4E4B]",action(t){console.log(t),g.value=null,M.value=t.companyId._id,P.value=!0}}]),C=c([]),A=c([]),Q=T(()=>A.value),O=T(()=>d.getAllLoans),H=c([]),v=c(0),F=c(10),ae=t=>{v.value=t,X()},X=()=>{le();let t=H.value;C.value=t.slice(v.value*F.value,v.value*F.value+F.value),C.value.length==0&&v.value>0&&ae(v.value-1)},Z=t=>t?{PENDING:{color:"text-[#F59E0B]",text:"Pending"},COMPLETED:{color:"text-[#219653]",text:"Completed"},DECLINED:{color:"text-[#EA4E4B]",text:"Rejected"},CUSTOMER_CANCELED:{color:"text-[#F59E0B]",text:"Cancelled"},APPROVED:{color:"text-[#359AA0]",text:"Active"}}[t]:{text:"N/A",color:""},ee=t=>({PAYROLL_COVER:"Payroll",ENTERPRISE_LOAN:"Enterprise",SALARY_ADVANCE:"Salary Advance"})[t],ne=T(()=>{if(!g.value||!h.value)return"";const t=h.value.getBoundingClientRect(),n=window.innerHeight;return t.bottom>n-20?"bottom-8":"top-0"});re(O,()=>{C.value=O.value&&O.value.filter(t=>t.status!=="PENDING")}),re(Q,t=>{const n=t.map(V=>V._id);console.log(n),y("selected",n)}),re(O,()=>{X()}),re(j,()=>{if(j.value.trim()!==""){const t=O.value&&O.value.filter(n=>n.status!=="PENDING");C.value=t.filter(n=>n.companyId.company.companyName.toLowerCase().includes(j.value.toLowerCase()))}else X()}),xe(()=>{X(),window.addEventListener("click",t=>{t.target.closest(".relative")||(g.value=!1)})});const le=()=>{H.value=O.value&&O.value.filter(t=>t.status!=="PENDING")},J=t=>{console.log(t);const n=t._id;f.push({name:"ViewLoan",params:{id:n}})},oe=t=>{const n=A.value.map(V=>V._id);console.log(n),y("selected",n)},de=t=>{const n=A.value.map(V=>V._id);y("selected",n)},ve=async()=>{try{b.value=!0;const t=await x({endpoint:"BlackListCompanyForLoan",data:{companyId:[M.value],loanBlackListed:!0}});P.value=!1,b.value=!1,console.log(t),t.success?(E.value=!0,l(),setTimeout(()=>{E.value=!1},3e3)):p.error(t.message)}catch(t){b.value=!1,console.log(t.message),p.error(t.message)}},l=async()=>{try{const n=await L({endpoint:"ListBlackListedLoanCompanies",payload:{sort:null},storeKey:"blackListedCompanies"});console.log(n)}catch(t){console.log(t.message)}};return(t,n)=>{const V=D("easiPaginate"),G=D("Column"),ce=D("DataTable"),se=D("easiButton"),a=D("easiAlert");return i(),m(W,null,[o("div",We,[o("div",Xe,[et,s(V,{data:H.value,"info-only":"","onPage:update":ae,currentPage:v.value,pageSize:F.value,"onUpdate:pageSize":n[0]||(n[0]=e=>F.value=e),visibleData:C.value},null,8,["data","currentPage","pageSize","visibleData"])]),s(ce,{selection:A.value,"onUpdate:selection":n[2]||(n[2]=e=>A.value=e),id:"table-style",class:"RowCursorPointer",dataKey:"_id",removableSort:"",scrollable:"",value:C.value,onRowSelect:oe,onRowUnselect:de},{default:u(()=>[s(G,{modelValue:A.value,"onUpdate:modelValue":n[1]||(n[1]=e=>A.value=e),selectionMode:"multiple",headerStyle:"width: 2rem"},null,8,["modelValue"]),s(G,{style:{"white-space":"nowrap"},sortable:"",field:"companyId.company.companyName",header:"Applicant"},{body:u(e=>[o("div",{onClick:$=>J(e.data),class:"applicant"},[o("div",null,[o("div",at,[e.data.companyId.company.logo?(i(),m("img",{key:0,src:e.data.companyId.company.logo,alt:"",class:"object-cover w-full h-full"},null,8,ot)):(i(),m("span",lt,_(w(k)(e.data.companyId.company.companyName)),1))])]),o("div",nt,_(e.data.companyId.company.companyName),1)],8,tt)]),_:1}),s(G,{sortable:"",field:"type",header:"Loan Type"},{body:u(e=>[o("div",{onClick:$=>J(e.data),class:"uppercase"},_(ee(e.data.type)),9,st)]),_:1}),s(G,{field:"loanAmountApplied",header:"Amount"},{body:u(e=>[o("div",{onClick:$=>J(e.data)},_(w(B)(e.data.loanAmountApplied)),9,rt)]),_:1}),s(G,{sortable:"",field:"createdAt",header:"Application Date"},{body:u(e=>[o("div",{onClick:$=>J(e.data)},_(w(N)(e.data.createdAt)),9,it)]),_:1}),s(G,{field:"totalRepaymentAmount",header:"Repayment"},{body:u(e=>[o("div",{onClick:$=>J(e.data)},_(w(B)(e.data.totalRepaymentAmount)),9,ct)]),_:1}),s(G,{field:"duration",header:"Period"},{body:u(e=>[o("div",{onClick:$=>J(e.data)},_(e.data.duration)+" "+_(e.data.durationPeriod),9,ut)]),_:1}),s(G,{sortable:"",field:"status",header:"Status"},{body:u(e=>[o("div",{onClick:$=>J(e.data),class:K(["font-bold",Z(e.data.status).color])},_(Z(e.data.status).text),11,dt)]),_:1}),s(G,{headerStyle:"width: 2rem",class:"relative"},{body:u(e=>[o("div",{onClick:$=>g.value=e.data._id},ft,8,vt),g.value===e.data._id?(i(),m("div",{key:0,ref_key:"dropdown",ref:h,class:K([w(ne),"dropdown"])},[(i(!0),m(W,null,ie(w(R),($,te)=>ye((i(),m("div",{key:`dropdown-${te}`,class:K([[$.color],"dropdown-item"]),onClick:ke=>$.action(e.data)},[o("span",null,_($.title),1),o("i",{class:K($.iconClass)},null,2)],10,mt)),[[we,$.show]])),128))],2)):q("",!0)]),_:1})]),_:1},8,["selection","value"]),s(V,{data:H.value,"onPage:update":ae,currentPage:v.value,pageSize:F.value,"onUpdate:pageSize":n[3]||(n[3]=e=>F.value=e),visibleData:C.value},null,8,["data","currentPage","pageSize","visibleData"]),o("div",{onClick:n[4]||(n[4]=e=>g.value=null),class:K([g.value?"":"pointer-events-none","bg-transparent fixed inset-0"])},null,2)]),P.value?(i(),U(a,{key:0,onClose:n[6]||(n[6]=e=>P.value=!1),icon:w(fe),title:"Blacklist Loan",caption:"Are you sure you want to blacklist this blacklist? However, this action will not be reversible once taken."},{default:u(()=>[o("div",yt,[s(se,{onClick:n[5]||(n[5]=e=>P.value=!1),variant:"outlined",block:""},{default:u(()=>[z("Cancel")]),_:1}),s(se,{onClick:ve,loading:b.value,block:""},{default:u(()=>[z("Yes")]),_:1},8,["loading"])])]),_:1},8,["icon"])):q("",!0),E.value?(i(),U(a,{key:1,onClose:n[8]||(n[8]=e=>E.value=!1),caption:"This business account has been successfully blacklisted."},{default:u(()=>[s(se,{onClick:n[7]||(n[7]=e=>E.value=!1),block:""},{default:u(()=>[z("Okay")]),_:1})]),_:1})):q("",!0)],64)}}},_t={class:"flex flex-col gap-4"},wt={class:"flex items-center justify-between"},ht=o("h2",{class:"text-xl"},"New Loan Requests",-1),bt=["onClick"],kt={class:"applicant-avatar"},Ct=["src"],Lt={key:1,class:"w-full h-full bg-primary flex items-center justify-center text-white font-medium;"},xt={class:"applicant-name"},At=["onClick"],$t=["onClick"],Rt=["onClick"],St=["onClick"],Et=["onClick"],Dt=["onClick"],It=["onClick"],Bt=o("i",{class:"pi pi-ellipsis-v text-dark-400 cursor-pointer"},null,-1),Nt=[Bt],jt=["onClick"],Tt={class:"grid grid-cols-2 gap-2"},Pt={class:"flex flex-col gap-6"},Ft={class:"grid grid-cols-2 gap-2"},qt={__name:"NewRequest",props:{searchText:{type:String,default:""}},emits:["selected"],setup(I,{emit:y}){const S=I,d=ue(),{query:L,mutate:x}=d,p=ge(),f=he(),{formatAmount:B,formatDate:N,initials:k}=be,j=T(()=>S.searchText),b=c(!1),E=c(!1),P=c(!1),M=c(""),g=c(!1),h=c(""),R=me({reject:!1}),C=c(null),A=c(null),Q=c(null),O=T(()=>[{title:"View",show:!0,iconClass:"far fa-eye",color:"text-[#11453B]",action(a){A.value=null,l(a)}},{title:"Approve",show:!0,iconClass:"fas fa-check",color:"text-[#219653]",action(a){console.log(a),A.value=null,C.value=a._id,E.value=!0}},{title:"Reject",show:!0,iconClass:"fas fa-times",color:"text-[#EA4E4B]",action(a){console.log(a),A.value=null,C.value=a._id,g.value=!0}}]),H=c([]),v=T(()=>d.getAllLoans),F=c([]),ae=T(()=>F.value),X=c([]),Z=c(0),ee=c(10),ne=a=>{Z.value=a,le()},le=()=>{ve();let a=X.value;H.value=a.slice(Z.value*ee.value,Z.value*ee.value+ee.value),H.value.length==0&&Z.value>0&&ne(Z.value-1)},J=a=>{if(a>=70)return"text-[#219653]";if(a>=50)return"text-[#B4A572]";if(a<=49)return"text-[#EF4444]"},oe=a=>({PAYROLL_COVER:"Payroll",ENTERPRISE_LOAN:"Enterprise",SALARY_ADVANCE:"Salary Advance"})[a],de=T(()=>{if(!A.value||!Q.value)return"";const a=Q.value.getBoundingClientRect(),e=window.innerHeight;return a.bottom>e-20?"bottom-8":"top-0"});re(ae,a=>{const e=a.map($=>$._id);console.log(e),y("selected",e)}),re(v,()=>{le()}),re(j,()=>{if(j.value.trim()!==""){const a=v.value&&v.value.filter(e=>e.status=="PENDING");H.value=a.filter(e=>e.companyId.company.companyName.toLowerCase().includes(j.value.toLowerCase()))}else le()}),xe(()=>{le(),window.addEventListener("click",a=>{a.target.closest(".relative")||(A.value=!1)})});const ve=()=>{X.value=v.value&&v.value.filter(a=>a.status=="PENDING")},l=a=>{const e=a._id;f.push({name:"ViewLoan",params:{id:e}})},t=a=>{const e=F.value.map($=>$._id);console.log(e),y("selected",e)},n=a=>{const e=F.value.map($=>$._id);y("selected",e)},V=async()=>{b.value=!0;try{const a=await x({endpoint:"ApproveLoan",data:{loanId:[C.value]}});b.value=!1,E.value=!1,console.log(a),a.success?(M.value="You have successfully approved this loan..",P.value=!0,ce(),setTimeout(()=>{P.value=!1},3e3)):p.error(a.message)}catch(a){b.value=!1,console.log(a.message),p.error(a.message)}},G=async()=>{if(h.value.trim()!==""){b.value=!0;try{const a=await x({endpoint:"CancelLoan",data:{loanId:[C.value],reason:h.value}});h.value="",b.value=!1,g.value=!1,console.log(a),a.success?(await ce(),M.value="This loan application has been successfully rejected.",P.value=!0,setTimeout(()=>{P.value=!1},3e3)):p.error(a.message)}catch(a){b.value=!1,console.log(a.message),p.error(a.message)}}else R.reject="Please add a reason"},ce=async()=>{const a={paging:{limit:1e3,skip:0,search:""},filter:{type:null,status:null},sort:{createdAt:-1}};try{const e=await L({endpoint:"ListLoans",payload:a,storeKey:"loans"});se(),console.log(e)}catch(e){console.log(e.message)}},se=async(a=!0)=>{try{const e=await L({endpoint:"QueryLoanReport",storeKey:"loanReport"});console.log(e)}catch(e){console.log(e.message)}};return(a,e)=>{const $=D("easiPaginate"),te=D("Column"),ke=D("DataTable"),pe=D("easiButton"),_e=D("easiAlert"),Ae=D("easiTextInput");return i(),m(W,null,[o("div",_t,[o("div",wt,[ht,s($,{data:X.value,"info-only":"","onPage:update":ne,currentPage:Z.value,pageSize:ee.value,"onUpdate:pageSize":e[0]||(e[0]=r=>ee.value=r),visibleData:H.value},null,8,["data","currentPage","pageSize","visibleData"])]),s(ke,{selection:F.value,"onUpdate:selection":e[2]||(e[2]=r=>F.value=r),id:"table-style",class:"RowCursorPointer",dataKey:"_id",scrollable:"",removableSort:"",value:H.value,onRowSelect:t,onRowUnselect:n},{default:u(()=>[s(te,{modelValue:F.value,"onUpdate:modelValue":e[1]||(e[1]=r=>F.value=r),selectionMode:"multiple",headerStyle:"width: 2rem"},null,8,["modelValue"]),s(te,{style:{"white-space":"nowrap"},sortable:"",field:"companyId.company.companyName",header:"Applicant"},{body:u(r=>[o("div",{onClick:Y=>l(r.data),class:"applicant"},[o("div",null,[o("div",kt,[r.data.companyId.company.logo?(i(),m("img",{key:0,src:r.data.companyId.company.logo,alt:"",class:"object-cover w-full h-full"},null,8,Ct)):(i(),m("span",Lt,_(w(k)(r.data.companyId.company.companyName)),1))])]),o("div",xt,_(r.data.companyId.company.companyName),1)],8,bt)]),_:1}),s(te,{sortable:"",field:"type",header:"Loan Type"},{body:u(r=>[o("div",{onClick:Y=>l(r.data),class:"uppercase"},_(oe(r.data.type)),9,At)]),_:1}),s(te,{sortable:"",field:"loanAmountApplied",header:"Amount"},{body:u(r=>[o("div",{onClick:Y=>l(r.data)},_(w(B)(r.data.loanAmountApplied)),9,$t)]),_:1}),s(te,{field:"duration",header:"Period"},{body:u(r=>[o("div",{onClick:Y=>l(r.data)},_(r.data.duration)+" "+_(r.data.durationPeriod),9,Rt)]),_:1}),s(te,{field:"totalIntrest",header:"Interest"},{body:u(r=>[o("div",{onClick:Y=>l(r.data)},_(r.data.totalIntrest),9,St)]),_:1}),s(te,{sortable:"",field:"creditReport",header:"Credit Score"},{body:u(r=>[o("div",{onClick:Y=>l(r.data),class:K(["font-bold",J(r.data.creditReport)])},_(r.data.creditReport),11,Et)]),_:1}),s(te,{sortable:"",field:"createdAt",header:"Application Date"},{body:u(r=>[o("div",{onClick:Y=>l(r.data)},_(w(N)(r.data.createdAt)),9,Dt)]),_:1}),s(te,{headerStyle:"width: 2rem",class:"relative"},{body:u(r=>[o("div",{onClick:Y=>A.value=r.data._id},Nt,8,It),A.value===r.data._id?(i(),m("div",{key:0,ref_key:"dropdown",ref:Q,class:K([w(de),"dropdown"])},[(i(!0),m(W,null,ie(w(O),(Y,$e)=>ye((i(),m("div",{key:`dropdown-${$e}`,class:K([[Y.color],"dropdown-item"]),onClick:ra=>Y.action(r.data)},[o("span",null,_(Y.title),1),o("i",{class:K(Y.iconClass)},null,2)],10,jt)),[[we,Y.show]])),128))],2)):q("",!0)]),_:1})]),_:1},8,["selection","value"]),s($,{data:X.value,"onPage:update":ne,currentPage:Z.value,pageSize:ee.value,"onUpdate:pageSize":e[3]||(e[3]=r=>ee.value=r),visibleData:H.value},null,8,["data","currentPage","pageSize","visibleData"]),o("div",{onClick:e[4]||(e[4]=r=>A.value=null),class:K([A.value?"":"pointer-events-none","bg-transparent fixed inset-0"])},null,2)]),P.value?(i(),U(_e,{key:0,onClose:e[6]||(e[6]=r=>P.value=!1),caption:M.value},{default:u(()=>[s(pe,{onClick:e[5]||(e[5]=r=>P.value=!1),block:""},{default:u(()=>[z("Okay")]),_:1})]),_:1},8,["caption"])):q("",!0),E.value?(i(),U(_e,{key:1,onClose:e[8]||(e[8]=r=>E.value=!1),icon:w(fe),title:"Approve Loan",caption:"Are you sure you want to approve this loan? However this action will not be reversible once taken."},{default:u(()=>[o("div",Tt,[s(pe,{onClick:e[7]||(e[7]=r=>E.value=!1),variant:"outlined",block:""},{default:u(()=>[z("Cancel")]),_:1}),s(pe,{onClick:V,loading:b.value,block:""},{default:u(()=>[z("Yes")]),_:1},8,["loading"])])]),_:1},8,["icon"])):q("",!0),g.value?(i(),U(_e,{key:2,onClose:e[11]||(e[11]=r=>g.value=!1),icon:w(fe),title:"Reject Loan Application",caption:"Are you sure you want to reject this loan application? Please give a reason why the loan is rejected."},{default:u(()=>[o("div",Pt,[s(Ae,{modelValue:h.value,"onUpdate:modelValue":e[9]||(e[9]=r=>h.value=r),error:R.reject,label:"Please give a reason"},null,8,["modelValue","error"]),o("div",Ft,[s(pe,{onClick:e[10]||(e[10]=r=>g.value=!1),variant:"outlined",block:""},{default:u(()=>[z("Cancel")]),_:1}),s(pe,{onClick:G,loading:b.value,block:""},{default:u(()=>[z("Confirm")]),_:1},8,["loading"])])])]),_:1},8,["icon"])):q("",!0)],64)}}},Vt={class:"flex flex-col gap-4"},Ot={class:"header flex items-center justify-between p-2 rounded-t-2xl px-4 py-3 text-white bg-[#292A29]"},zt=o("h2",{class:"text-xl"},"Blacklisted",-1),Ut={class:"flex items-center gap-4"},Ht={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-2 sm:gap-4 items-center bg-[#F2F1F1] p-4"},Gt={class:"flex items-center gap-2"},Kt={class:"w-9 h-9 overflow-hidden flex-shrink-0 rounded-full bg-tertiary text-white flex items-center justify-center text-xs font-semibold"},Mt=["src"],Yt={key:1,class:"w-full h-full bg-primary flex items-center justify-center"},Qt={__name:"BlackListed",setup(I){const{initials:y}=be,S=ue(),{query:d,mutate:L}=S,x=ge(),p=c(!1),f=c(!1),B=c([]),N=T(()=>S.getBlackListed),k=c([]);console.log("Black Listed",N.value);const j=c(0),b=c(10),E=h=>{j.value=h,P()},P=()=>{let h=N.value;k.value=h.slice(j.value*b.value,j.value*b.value+b.value),k.value.length==0&&j.value>0&&E(j.value-1)};P();const M=async()=>{if(B.value.length){f.value=!0;try{const h=await L({endpoint:"BlackListCompanyForLoan",data:{companyId:B.value,loanBlackListed:!1}});f.value=!1,h.success?(p.value=!0,B.value=[],g(),setTimeout(()=>{p.value=!1},3e3)):x.error(h.message)}catch(h){f.value=!1,console.log(h.message)}}else x.error("Select at least one company")},g=async()=>{try{f.value=!0;const R=await d({endpoint:"ListBlackListedLoanCompanies",payload:{sort:null},storeKey:"blackListedCompanies"});console.log(R),f.value=!1}catch(h){f.value=!1,console.log(h.message)}};return g(),(h,R)=>{const C=D("easiButton"),A=D("easiPaginate"),Q=D("Checkbox"),O=D("easiAlert"),H=D("easiLoader");return i(),m(W,null,[o("div",Vt,[o("div",Ot,[zt,o("div",Ut,[s(C,{onClick:M,loading:f.value,variant:"outlined",size:"medium",color:"white"},{default:u(()=>[z("Restore")]),_:1},8,["loading"]),s(A,{data:w(N),"info-only":"","onPage:update":E,currentPage:j.value,pageSize:b.value,"onUpdate:pageSize":R[0]||(R[0]=v=>b.value=v),visibleData:k.value},null,8,["data","currentPage","pageSize","visibleData"])])]),o("div",Ht,[(i(!0),m(W,null,ie(w(N),(v,F)=>(i(),m("div",{key:`company-${F}`,class:"flex items-center gap-2 text-sm"},[s(Q,{modelValue:B.value,"onUpdate:modelValue":R[1]||(R[1]=ae=>B.value=ae),value:v&&v._id,inputId:v&&v._id},null,8,["modelValue","value","inputId"]),o("div",Gt,[o("div",Kt,[v&&v.company.logo?(i(),m("img",{key:0,src:v&&v.company.logo,alt:"object-cover  w-full h-full"},null,8,Mt)):(i(),m("span",Yt,_(w(y)(v&&v.company.companyName)),1))]),o("div",null,_(v&&v.company.companyName),1)])]))),128))]),s(A,{data:w(N),"info-only":"","onPage:update":E,currentPage:j.value,pageSize:b.value,"onUpdate:pageSize":R[2]||(R[2]=v=>b.value=v),visibleData:k.value},null,8,["data","currentPage","pageSize","visibleData"])]),p.value?(i(),U(O,{key:0,onClose:R[4]||(R[4]=v=>p.value=!1),caption:"This business account has been successfully restores."},{default:u(()=>[s(C,{onClick:R[3]||(R[3]=v=>p.value=!1),block:""},{default:u(()=>[z("Okay")]),_:1})]),_:1})):q("",!0),f.value?(i(),U(H,{key:1})):q("",!0)],64)}}},Zt={class:"my-6 flex flex-wrap gap-4 items-center justify-around"},Jt={class:"grow w-72 flex items-center gap-2"},Wt={class:"grow"},Xt={class:"border border-dark-100 rounded-xl p-2 flex gap-4 items-center justify-around"},ea=["onClick"],ta={key:0,class:"absolute -top-4 font-bold right-0 bg-secondary px-1.5 text-white rounded-xl text-xs"},aa={class:"xl:grow flex flex-wrap items-center sm:justify-around gap-2"},oa={class:"py-4"},la={class:"grid grid-cols-2 gap-2"},na={class:"flex flex-col gap-6"},sa={class:"grid grid-cols-2 gap-2"},va={__name:"Index",setup(I){const y=ue(),{query:S,mutate:d}=y,L=ge(),x=Le(),p=he(),f=c(!1),B=c(""),N=c(""),k=c(!1),j=c(!1),b=c(!1),E=c(""),P=me({reject:!1}),M=c(!1),g=c(!1),h=c(""),R=c(""),C=c([]);let A=me({paging:{limit:1e3,skip:0,search:""},filter:{type:null,status:null},sort:{createdAt:-1}});const Q=T(()=>y.getAllLoans),O=T(()=>x.query.type?x.query.type:"current_loan"),H=T(()=>{const l=Q.value&&Q.value.filter(n=>n.status=="PENDING"),t=l?l.length:0;return[{title:"Current Loan",slug:"current_loan"},{title:"New Request",slug:"new_request",value:t},{title:"Blacklisted",slug:"blacklisted"}]}),v=T(()=>{const l=x.query.type?x.query.type:"current_loan";return[{title:"Approve",disabled:l!=="new_request",action(){C.value.length?(B.value="Approve Loan",N.value="Are you sure you want to approve this loan? However this action will not be reversible once taken.",f.value=!0):L.error("Select at least one loan")},variant:"fill"},{title:"Clear off",disabled:l!=="current_loan",action(){C.value.length?(B.value="Clear Loan",N.value="Are you sure you want to clear this loan? However, this action will not be reversible once taken.",f.value=!0):L.error("Select at least one loan")},variant:"outlined"},{title:"Black List",disabled:l=="blacklisted",action(){C.value.length?(B.value="Blacklist Loan",N.value="Are you sure you want to blacklist this blacklist? However, this action will not be reversible once taken.",f.value=!0):L.error("Select at least one loan")},variant:"outlined"},{title:"Reject",disabled:l!=="new_request",action(){C.value.length?b.value=!0:L.error("Select at least one loan")},variant:"outlined"}]}),F=async l=>{k.value=!0,l=="Approve Loan"?await ae():l=="Clear Loan"?await X():l=="Blacklist Loan"&&await Z(),k.value=!1},ae=async()=>{try{const l=await d({endpoint:"ApproveLoan",data:{loanId:C.value}});f.value=!1,console.log(l),l.success?(h.value="You have successfully approved this loan..",g.value=!0,oe(),setTimeout(()=>{g.value=!1},3e3)):L.error(l.message)}catch(l){console.log(l.message),L.error(l.message)}},X=async()=>{try{const l=await d({endpoint:"ClearLoan",data:{loanId:C.value[0]}});f.value=!1,console.log(l),l.success?(h.value="This loan has been successfully cleared off.",g.value=!0,oe(),setTimeout(()=>{g.value=!1},3e3)):L.error(l.message)}catch(l){console.log(l.message),L.error(l.message)}},Z=async()=>{const l=[];C.value.forEach(t=>{const n=ne(t);console.log("Selected",n),n&&l.push(n.companyId._id)}),console.log(l);try{const t=await d({endpoint:"BlackListCompanyForLoan",data:{companyId:l,loanBlackListed:!0}});f.value=!1,console.log(t),t.success?(h.value="This business account has been successfully blacklisted.",g.value=!0,setTimeout(()=>{g.value=!1},3e3),await de(),p.replace({query:{type:"blacklisted"}})):L.error(t.message)}catch(t){console.log(t.message)}},ee=async()=>{if(E.value.trim()!==""){j.value=!0;try{const l=await d({endpoint:"CancelLoan",data:{loanId:C.value,reason:E.value}});E.value="",j.value=!1,b.value=!1,console.log(l),l.success?(await oe(!1),h.value="This loan application has been successfully rejected.",g.value=!0,setTimeout(()=>{g.value=!1},3e3)):L.error(l.message)}catch(l){j.value=!1,console.log(l.message),L.error(l.message)}}else P.reject="Please add a reason"},ne=l=>Q.value&&Q.value.find(t=>t._id===l),le=()=>{console.log(R.value)},J=l=>{console.log("Filter",l),A=l,oe()},oe=async(l=!0)=>{console.log("Loan",A);try{M.value=l;const t=await S({endpoint:"ListLoans",payload:A,storeKey:"loans"});ve(),console.log(t),M.value=!1}catch(t){M.value=!1,console.log(t.message)}},de=async()=>{try{const t=await S({endpoint:"ListBlackListedLoanCompanies",payload:{sort:null},storeKey:"blackListedCompanies"});console.log(t)}catch(l){console.log(l.message)}},ve=async(l=!0)=>{try{const t=await S({endpoint:"QueryLoanReport",storeKey:"loanReport"});console.log(t)}catch(t){console.log(t.message)}};return oe(),(l,t)=>{const n=D("easiSearch"),V=D("easiButton"),G=D("easiAlert"),ce=D("easiTextInput"),se=D("easiLoader");return i(),m(W,null,[o("div",null,[s(Ve)]),o("div",Zt,[o("div",Jt,[s(n,{class:"grow",onSearch:le,modelValue:R.value,"onUpdate:modelValue":t[0]||(t[0]=a=>R.value=a),placeholder:"Search"},null,8,["modelValue"]),s(Je,{onFilter:J})]),o("div",Wt,[o("div",Xt,[(i(!0),m(W,null,ie(w(H),(a,e)=>(i(),m("div",{onClick:$=>l.$router.push({query:{type:a.slug}}),key:e,class:K([{"font-bold underline underline-offset-4 decoration-2 ":w(O)==a.slug},"relative text-sm cursor-pointer"])},[z(_(a.title)+" ",1),a.value?(i(),m("span",ta,_(a.value&&a.value.toLocaleString()),1)):q("",!0)],10,ea))),128))])]),o("div",aa,[(i(!0),m(W,null,ie(w(v),(a,e)=>(i(),U(V,{onClick:a.action,key:e,disabled:a.disabled,variant:a.variant,size:"medium"},{default:u(()=>[z(_(a.title),1)]),_:2},1032,["onClick","disabled","variant"]))),128))])]),o("div",oa,[w(O)==="current_loan"?(i(),U(gt,{key:0,onSelected:t[1]||(t[1]=a=>C.value=a),searchText:R.value},null,8,["searchText"])):q("",!0),w(O)==="new_request"?(i(),U(qt,{key:1,onSelected:t[2]||(t[2]=a=>C.value=a),searchText:R.value},null,8,["searchText"])):q("",!0),w(O)==="blacklisted"?(i(),U(Qt,{key:2})):q("",!0)]),f.value?(i(),U(G,{key:0,onClose:t[5]||(t[5]=a=>f.value=!1),icon:w(fe),title:B.value,caption:N.value},{default:u(()=>[o("div",la,[s(V,{onClick:t[3]||(t[3]=a=>f.value=!1),variant:"outlined",block:""},{default:u(()=>[z("Cancel")]),_:1}),s(V,{onClick:t[4]||(t[4]=a=>F(B.value)),loading:k.value,block:""},{default:u(()=>[z("Yes")]),_:1},8,["loading"])])]),_:1},8,["icon","title","caption"])):q("",!0),g.value?(i(),U(G,{key:1,onClose:t[7]||(t[7]=a=>g.value=!1),caption:h.value},{default:u(()=>[s(V,{onClick:t[6]||(t[6]=a=>g.value=!1),block:""},{default:u(()=>[z("Okay")]),_:1})]),_:1},8,["caption"])):q("",!0),b.value?(i(),U(G,{key:2,onClose:t[10]||(t[10]=a=>b.value=!1),icon:w(fe),title:"Reject Loan Application",caption:"Are you sure you want to reject this loan application? Please give a reason why the loan is rejected."},{default:u(()=>[o("div",na,[s(ce,{modelValue:E.value,"onUpdate:modelValue":t[8]||(t[8]=a=>E.value=a),error:P.reject,label:"Please give a reason"},null,8,["modelValue","error"]),o("div",sa,[s(V,{onClick:t[9]||(t[9]=a=>b.value=!1),variant:"outlined",block:""},{default:u(()=>[z("Cancel")]),_:1}),s(V,{onClick:ee,loading:j.value,block:""},{default:u(()=>[z("Confirm")]),_:1},8,["loading"])])])]),_:1},8,["icon"])):q("",!0),M.value?(i(),U(se,{key:3})):q("",!0)],64)}}};export{va as default};
//# sourceMappingURL=Index-ec88bd36.js.map
