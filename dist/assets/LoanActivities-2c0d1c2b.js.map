{"version":3,"file":"LoanActivities-2c0d1c2b.js","sources":["../../src/components/Loan/ConfirmPayment.vue","../../src/components/Loan/LoanActivities.vue"],"sourcesContent":["<template>\n  <easiModal v-if=\"isOpen\" persistence @close=\"$emit('close')\">\n    <template #header>\n      <h2 class=\"font-medium\">Confirm Payment</h2>\n    </template>\n\n    <div class=\"pt-2 pb-4 flex flex-col gap-4 sm:gap-6\">\n      <p class=\"mx-4 sm:mx-6 font-bold text-secondary text-center text-sm\">\n        Please ensure you confirm the money paid by this customer has been remitted into Eazipayâ€™s\n        account.\n      </p>\n\n      <div class=\"mx-4 sm:mx-6\">\n        <easiTextInput\n          label=\"Enter Amount\"\n          v-model=\"args.amount\"\n          format\n          type=\"text\"\n          inputmode=\"numeric\"\n          class=\"\"\n          :error=\"errorRules.amount\"\n        />\n      </div>\n\n      <div class=\"mx-4 sm:mx-6\">\n        <easiUpload\n          :error=\"errorRules.photoUrl\"\n          @fileUrl=\"args.photoUrl = $event\"\n          title=\"Upload Payment Receipt\"\n        />\n      </div>\n\n      <div class=\"mx-4 sm:mx-6 cursor-pointer flex items-center justify-center gap-2\">\n        <Checkbox\n          :class=\"{ 'p-invalid': errorRules.accept }\"\n          v-model=\"confirmPayment\"\n          :binary=\"true\"\n        />\n        <span\n          @click=\"confirmPayment = !confirmPayment\"\n          :class=\"[errorRules.accept ? 'text-secondary' : 'text-primary']\"\n        >\n          I have confirmed the payment\n        </span>\n      </div>\n\n      <hr class=\"mt-2 mb-3 border border-dividerColor text-dividerColor\" />\n\n      <div class=\"mx-4 sm:mx-6 grid grid-cols-2 gap-4 items-center place-content-center\">\n        <easiButton @click=\"$emit('close')\" variant=\"outlined\" block>Cancel</easiButton>\n        <easiButton :loading=\"loading\" @click=\"submit\" block>Confirm Payment</easiButton>\n      </div>\n    </div>\n  </easiModal>\n\n  <easiAlert\n    @close=\"showAlert = false\"\n    v-if=\"showAlert\"\n    caption=\"Payment has been successfully confirmed\"\n  >\n    <easiButton @click=\"showAlert = false\" block>Okay</easiButton>\n  </easiAlert>\n</template>\n\n<script setup>\nimport { reactive, ref } from 'vue'\nimport { helperFunctions } from '@/composable/helperFunctions'\nimport { useDataStore } from '@/stores/data.js'\nimport { useToast } from 'vue-toastification'\n\nconst store = useDataStore()\nconst { query, mutate } = store\nconst toast = useToast()\nconst { uploadFileToServer } = helperFunctions\n\nconst props = defineProps({\n  isOpen: {\n    type: Boolean,\n    default: false\n  },\n\n  loan: {\n    type: Object,\n    default: () => ({})\n  }\n})\ndefineEmits(['close'])\n\nconst loading = ref(false)\nconst confirmPayment = ref(false)\nconst showAlert = ref(false)\n\nconst args = reactive({\n  amount: '',\n  photoUrl: ''\n})\n\nconst errorRules = reactive({\n  amount: false,\n  photoUrl: false,\n  accept: false\n})\n\nconst validation = () => {\n  if (args.amount.trim() == '' && args.amount >= 0) {\n    errorRules.amount = 'Please enter a valid amount'\n    return false\n  } else if (!args.photoUrl) {\n    errorRules.photoUrl = 'Please select a receipt file'\n    return false\n  } else if (!confirmPayment.value) {\n    errorRules.accept = true\n    return false\n  } else {\n    errorRules.amount = false\n    errorRules.photoUrl = false\n    errorRules.accept = false\n    return true\n  }\n}\n\nconst submit = async () => {\n  if (validation()) {\n    loading.value = true\n\n    const url = await uploadFileToServer(args.photoUrl)\n\n    const payload = {\n      amount: parseFloat(args.amount),\n      loanId: props.loan && props.loan._id,\n      photoUrl: url\n    }\n    console.log(payload)\n\n    try {\n      const res = await mutate({\n        endpoint: 'ConfirmLoanPayment',\n        data: payload\n      })\n\n      console.log(res)\n\n      if (res.success) {\n        showAlert.value = true\n        await queryLoanActivities()\n        setTimeout(() => {\n          showAlert.value = false\n        }, 3000)\n      } else {\n        toast.error(res.message)\n      }\n\n      loading.value = false\n    } catch (error) {\n      loading.value = false\n      console.log(error.message)\n      toast.error(error.message)\n    }\n  }\n}\n\nconst queryLoanActivities = async () => {\n  try {\n    loading.value = true\n\n    const res = await query({\n      endpoint: 'ListLoanActivity',\n      payload: {\n        loanId: props.loan._id\n      },\n      storeKey: 'loanActivities'\n    })\n\n    console.log(res)\n\n    loading.value = false\n  } catch (error) {\n    loading.value = false\n    console.log(error.message)\n  }\n}\n</script>\n\n<style></style>\n","<template>\n  <div class=\"\">\n    <div class=\"flex items-center justify-between\">\n      <span class=\"text-lg mb-2\">Loan Activities</span>\n      <easiButton @click=\"comfirmPaymentModal = true\">Confirm Payment</easiButton>\n    </div>\n    <div v-if=\"activities && activities.length\" class=\"max-h-96 overflow-y-auto mt-2\">\n      <div\n        v-for=\"(activity, i) in activities\"\n        :key=\"i\"\n        class=\"text-sm text-dark-800 grid grid-cols-2 sm:grid-cols-4 place-content-center items-center gap-4 border-b py-2 last:border-0 border-dark-400\"\n      >\n        <span class=\"\">{{ formatDate(activity.createdAt) }}</span>\n\n        <div class=\"flex items-center gap-2\">\n          <div\n            class=\"w-9 h-9 overflow-hidden flex-shrink-0 rounded-full bg-tertiary text-white flex items-center justify-center text-xs font-semibold\"\n          >\n            <img\n              v-if=\"loan && loan.companyId.company.logo\"\n              :src=\"loan && loan.companyId.company.logo\"\n              alt=\"object-cover\"\n            />\n            <span v-else class=\"w-full h-full bg-primary flex items-center justify-center\">\n              {{ initials(loan && loan.companyId.company.companyName) }}\n            </span>\n          </div>\n          <span>{{ fullName }}</span>\n        </div>\n\n        <span class=\"\">{{ formatType(activity.type) }}</span>\n        <span class=\"font-bold\">\n          {{ formatAmount(activity.amount) }}\n        </span>\n      </div>\n    </div>\n\n    <div class=\"p-6 text-center text-dark-500\">No Activities yet</div>\n  </div>\n\n  <ConfirmPayment :loan=\"loan\" :isOpen=\"comfirmPaymentModal\" @close=\"comfirmPaymentModal = false\" />\n</template>\n\n<script setup>\nimport ConfirmPayment from './ConfirmPayment.vue'\n\nimport { helperFunctions } from '@/composable/helperFunctions'\nimport { computed, ref } from 'vue'\nimport { useDataStore } from '@/stores/data.js'\n\nconst store = useDataStore()\nconst { query, mutate } = store\nconst { formatAmount, formatDate, initials } = helperFunctions\n\nconst props = defineProps({\n  loan: {\n    type: Object,\n    default: () => ({})\n  }\n})\n\nconst loading = ref(false)\nconst comfirmPaymentModal = ref(false)\n\nconst activities = computed(() => store.getLoanActivities)\nconsole.log('Activites.....', activities.value)\n\nconst formatType = (type) => {\n  const obj = {\n    PART_PAYMENT: 'Part Payment',\n    CONFIRM_PAYMENT: 'Confirm Payment'\n  }\n\n  return type ? obj[type] : 'N/A'\n}\n\nconst fullName = computed(() => {\n  if (props.loan) {\n    return props.loan.companyId.company.companyName\n  } else {\n    return 'N/A'\n  }\n})\n\nconst queryLoanActivities = async () => {\n  try {\n    loading.value = true\n\n    const res = await query({\n      endpoint: 'ListLoanActivity',\n      payload: {\n        loanId: props.loan._id\n      },\n      storeKey: 'loanActivities'\n    })\n\n    console.log(res)\n\n    loading.value = false\n  } catch (error) {\n    loading.value = false\n    console.log(error.message)\n  }\n}\nqueryLoanActivities()\n</script>\n\n<style scope></style>\n"],"names":["store","useDataStore","query","mutate","toast","useToast","uploadFileToServer","helperFunctions","loading","ref","confirmPayment","showAlert","args","reactive","errorRules","validation","submit","url","payload","props","res","queryLoanActivities","error","formatAmount","formatDate","initials","comfirmPaymentModal","activities","computed","formatType","type","fullName"],"mappings":"o4BAsEMA,EAAQC,EAAc,EACtB,CAAE,MAAAC,EAAO,OAAAC,CAAM,EAAKH,EACpBI,EAAQC,EAAU,EAClB,CAAE,mBAAAC,CAAoB,EAAGC,EAezBC,EAAUC,EAAI,EAAK,EACnBC,EAAiBD,EAAI,EAAK,EAC1BE,EAAYF,EAAI,EAAK,EAErBG,EAAOC,EAAS,CACpB,OAAQ,GACR,SAAU,EACZ,CAAC,EAEKC,EAAaD,EAAS,CAC1B,OAAQ,GACR,SAAU,GACV,OAAQ,EACV,CAAC,EAEKE,EAAa,IACbH,EAAK,OAAO,KAAI,GAAM,IAAMA,EAAK,QAAU,GAC7CE,EAAW,OAAS,8BACb,IACGF,EAAK,SAGLF,EAAe,OAIzBI,EAAW,OAAS,GACpBA,EAAW,SAAW,GACtBA,EAAW,OAAS,GACb,KANPA,EAAW,OAAS,GACb,KAJPA,EAAW,SAAW,+BACf,IAYLE,EAAS,SAAY,CACzB,GAAID,EAAU,EAAI,CAChBP,EAAQ,MAAQ,GAEhB,MAAMS,EAAM,MAAMX,EAAmBM,EAAK,QAAQ,EAE5CM,EAAU,CACd,OAAQ,WAAWN,EAAK,MAAM,EAC9B,OAAQO,EAAM,MAAQA,EAAM,KAAK,IACjC,SAAUF,CACX,EACD,QAAQ,IAAIC,CAAO,EAEnB,GAAI,CACF,MAAME,EAAM,MAAMjB,EAAO,CACvB,SAAU,qBACV,KAAMe,CACd,CAAO,EAED,QAAQ,IAAIE,CAAG,EAEXA,EAAI,SACNT,EAAU,MAAQ,GAClB,MAAMU,EAAqB,EAC3B,WAAW,IAAM,CACfV,EAAU,MAAQ,EACnB,EAAE,GAAI,GAEPP,EAAM,MAAMgB,EAAI,OAAO,EAGzBZ,EAAQ,MAAQ,EACjB,OAAQc,EAAP,CACAd,EAAQ,MAAQ,GAChB,QAAQ,IAAIc,EAAM,OAAO,EACzBlB,EAAM,MAAMkB,EAAM,OAAO,CAC1B,EAEL,EAEMD,EAAsB,SAAY,CACtC,GAAI,CACFb,EAAQ,MAAQ,GAEhB,MAAMY,EAAM,MAAMlB,EAAM,CACtB,SAAU,mBACV,QAAS,CACP,OAAQiB,EAAM,KAAK,GACpB,EACD,SAAU,gBAChB,CAAK,EAED,QAAQ,IAAIC,CAAG,EAEfZ,EAAQ,MAAQ,EACjB,OAAQc,EAAP,CACAd,EAAQ,MAAQ,GAChB,QAAQ,IAAIc,EAAM,OAAO,CAC1B,CACH,w/DClIMtB,EAAQC,EAAc,EACtB,CAAE,MAAAC,EAAO,OAAAC,CAAM,EAAKH,EACpB,CAAE,aAAAuB,EAAc,WAAAC,EAAY,SAAAC,CAAQ,EAAKlB,EASzCC,EAAUC,EAAI,EAAK,EACnBiB,EAAsBjB,EAAI,EAAK,EAE/BkB,EAAaC,EAAS,IAAM5B,EAAM,iBAAiB,EACzD,QAAQ,IAAI,iBAAkB2B,EAAW,KAAK,EAE9C,MAAME,EAAcC,GAMXA,EALK,CACV,aAAc,eACd,gBAAiB,iBAClB,EAEiBA,CAAI,EAAI,MAGtBC,EAAWH,EAAS,IACpBT,EAAM,KACDA,EAAM,KAAK,UAAU,QAAQ,YAE7B,KAEV,EAsBD,OApB4B,SAAY,CACtC,GAAI,CACFX,EAAQ,MAAQ,GAEhB,MAAMY,EAAM,MAAMlB,EAAM,CACtB,SAAU,mBACV,QAAS,CACP,OAAQiB,EAAM,KAAK,GACpB,EACD,SAAU,gBAChB,CAAK,EAED,QAAQ,IAAIC,CAAG,EAEfZ,EAAQ,MAAQ,EACjB,OAAQc,EAAP,CACAd,EAAQ,MAAQ,GAChB,QAAQ,IAAIc,EAAM,OAAO,CAC1B,CACH,GACqB"}