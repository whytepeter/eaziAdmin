import{s as D,C as U,y as le,d as w,g as G,o,c as i,a as e,F as L,e as j,n as J,t as h,u as _,I as Q,b as y,H as X,m as V,i as d,G as Z,D as K,x as S,j as E,l as oe,k as I,f as q}from"./index-351c9552.js";import{_ as ae,E as ne,R as ie}from"./removeIcon-e7818cde.js";import{C as re}from"./confirm-cfbddac4.js";const ce=e("div",{class:"uppercase text-sm text-white bg-primary px-3 py-1 rounded-lg"},"Roles",-1),ue={class:"flex flex-col gap-4 h-96 overflow-y-auto mt-6 text-sm"},de=["onClick"],me={__name:"RoleList",setup(g){const C=D(),r=U(),R=le(),c=w(()=>C.getAllRoles);return console.log("All Roles",c.value),G(()=>{r.query&&!r.query.id&&c.value.length&&R.push({query:{id:c.value[0]._id}})}),(b,A)=>(o(),i("div",null,[ce,e("div",ue,[(o(!0),i(L,null,j(_(c),l=>(o(),i("div",{key:l._id,onClick:f=>b.$router.push({query:{id:l._id}}),class:J([{"text-primary font-bold bg-[#F2F1F1]":l._id===b.$route.query.id},"py-2 px-3 rounded-xl cursor-pointer capitalize text-dark-700 hover:text-primary hover:font-bold hover:bg-[#F2F1F1]"])},h(l.title),11,de))),128))])]))}},pe=e("div",{class:"text-sm mb-3"},"Team Members with the role",-1),ve={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 place-content-start items-center gap-2 max-h-24 overflow-y-auto"},fe={class:"w-8 h-8 flex-shrink-0 bg-primary overflow-hidden rounded-full flex items-center justify-center"},_e=["src"],ge={key:1,class:"text-white text-sm"},xe={class:"text-dark-800 text-sm"},ye={key:1,class:"text-sm text-dark-700"},he={__name:"TeamMember",setup(g){const{initials:C}=Q,r=U(),R=D(),c=w(()=>{const b=r.query.id;return R.getAdminByRole(b)});return console.log("Admin By Role",c.value),(b,A)=>(o(),i("div",null,[pe,_(c)&&_(c).length?(o(),i("div",ve,[(o(!0),i(L,null,j(_(c),l=>(o(),i("div",{key:l._id,class:"flex items-center gap-2 py-1 px-2 border border-[#E7E8E7] bg-[#F2F1F1] rounded-lg"},[e("div",fe,[l&&l.pfp?(o(),i("img",{key:0,src:l&&l.pfp,alt:"",class:"w-full h-full object-cover"},null,8,_e)):(o(),i("span",ge,h(_(C)(`${l&&l.firstName} ${l&&l.lastName}`)),1))]),e("span",xe,h(l&&l.firstName)+" "+h(l&&l.lastName),1)]))),128))])):(o(),i("div",ye,"N/A"))]))}},be={class:"flex flex-col gap-4"},ke={class:"max-h-56 overflow-y-auto"},$e={class:"text-dark-700"},we={key:0,class:"pi pi-check text-sm text-success"},Ce={key:1,class:"pi pi-times text-sm text-secondary"},W={__name:"DisplayRoles",props:{hasAccess:{type:Boolean,default:!0}},setup(g){const C=g,r=D(),R=U(),c=y(""),b=w(()=>r.getAllRoles),A=["Admin_Management","Dashboard","Reports","Company_Management","Feedback","Loan_Managment"],l=y([]),f=w(()=>b.value.find(a=>a._id===R.query.id)),m=w(()=>f.value?f.value.privileges:[]),k=w(()=>A.filter(a=>!m.value.includes(a))),$=()=>{l.value=C.hasAccess?m.value:k.value};G(()=>{$()}),X(f,()=>{console.log(f.value,m.value),$()});const p=a=>a&&a.split("_").join(" "),t=()=>{c.value.trim()==""?$():l.value=l.value.filter(a=>a.title.toLowerCase().includes(c.value.toLowerCase()))};return(a,M)=>{const B=V("easiSearch");return o(),i("div",be,[e("div",{class:J([[g.hasAccess?"bg-primary":"bg-secondary"],"text-sm text-center text-white px-3 py-1 rounded-lg"])},h(g.hasAccess?"What Role Can Access":"What Role Cannot Access"),3),d(B,{placeholder:"Search..",modelValue:c.value,"onUpdate:modelValue":M[0]||(M[0]=F=>c.value=F),onKeyup:t,onSearch:t},null,8,["modelValue"]),e("div",ke,[(o(!0),i(L,null,j(l.value,F=>(o(),i("div",{key:F._id,class:"flex items-center justify-between p-2 text-sm"},[e("span",$e,h(p(F)),1),g.hasAccess?(o(),i("i",we)):(o(),i("i",Ce))]))),128))])])}}},Re={class:"p-6 flex flex-col gap-4 sm:gap-6"},Ae={class:"text-2xl"},Fe=["onSubmit"],Ve={class:"flex gap-2"},Ee={class:"grow"},Me={key:0,class:"flex flex-col gap-4 max-h-36 overflow-y-auto"},Ie={class:"w-7 h-7 flex-shrink-0 bg-primary overflow-hidden rounded-full flex items-center justify-center"},Le={class:"text-white text-sm"},qe={class:"w-full text-dark-800 text-sm flex items-center justify-between gap-2"},Be=["onClick"],Ne={class:"flex flex-col gap-4"},Oe=e("div",{class:"py-2 px-4 bg-[#F2F1F1] font-bold text-dark-800 uppercase rounded-lg"}," Privileges ",-1),Se={class:"flex flex-col gap-2 max-h-28 overflow-y-auto"},je=e("hr",{class:"border border-dividerColor text-dividerColor"},null,-1),De=e("p",{class:"text-center text-primary text-sm sm:px-6 mx-auto"}," Please select any of the following permission you would like to assign to this role ",-1),Te={class:"grid grid-cols-2 gap-4 items-center place-content-center"},Y={__name:"CreateRole",props:{isOpen:{type:Boolean,default:!1},type:{type:String,default:"create"},role:{type:Object,default:()=>({})}},emits:["close"],setup(g,{emit:C}){const r=g,R=D(),{query:c,mutate:b}=R,A=Z(),{validateEmail:l}=Q,f=w(()=>r.role),m=y(!1),k=y(!1),$=K({"Admin Management":"Admin_Management",Dashboard:"Dashboard",Reports:"Reports","Company Management":"Company_Management",Feedback:"Feedback","Loan Managment":"Loan_Managment"}),p=y(""),t=K({title:"",description:"",email:[],privileges:null}),a=K({title:!1,description:!1});function M(){if(r.type.toLowerCase()=="edit"&&r.role){const n=["title","description","email","privileges"];for(let s=0;s<n.length;s++)r.role&&r.role[n[s]]&&(t[n[s]]=r.role[n[s]])}}M(),X(f,()=>{console.log(r.role),M()});function B(){return t.title.trim()===""?(a.title="Please fill in the role title",!1):(Object.keys(a).forEach(n=>{a[n]=!1}),!0)}const F=()=>{const n=t.email.find(s=>s==p.value);if(p.value.trim()==""&&!l(p.value))a.email="Email is badly formatted";else{if(n)return a.email="Email exist already",!1;a.email=!1,t.email.push(p.value),p.value=""}},x=n=>{t.email=t.email.filter(s=>s!==n)},u=()=>{t.title="",t.description="",t.email=[],t.privileges=null},N=async()=>{if(!t.email.length&&p.value.trim()!==""&&t.email.push(p.value),B()){console.log(t),m.value=!0;try{const n=await b({endpoint:r.type.toLowerCase()=="create"?"CreateRole":"EditRole",data:{input:t}});console.log(n),m.value=!1,n.success?(u(),C("close"),await T(),k.value=!0,setTimeout(()=>{k.value=!1},3e3)):A.error(n.message)}catch(n){m.value=!1,console.log(n.message)}}},T=async()=>{try{m.value=!0;const n=await c({endpoint:"ListRoles",storeKey:"listRoles"});console.log("Roles",n),m.value=!1}catch(n){m.value=!1,console.log(n.message)}};return(n,s)=>{const P=V("easiTextInput"),z=V("easiButton"),ee=V("Checkbox"),te=V("easiModal"),se=V("easiAlert");return o(),i(L,null,[g.isOpen?(o(),S(te,{key:0,persistence:"",onClose:s[5]||(s[5]=v=>n.$emit("close"))},{default:E(()=>[e("div",Re,[e("div",Ae,h(g.type=="create"?"Create New Role":"Edit Role"),1),e("form",{onSubmit:oe(N,["prevent"]),ref:"form",autocomplete:"on",class:"flex flex-col gap-6"},[d(P,{modelValue:t.title,"onUpdate:modelValue":s[0]||(s[0]=v=>t.title=v),label:"Input role name",error:a.title},null,8,["modelValue","error"]),d(P,{modelValue:t.description,"onUpdate:modelValue":s[1]||(s[1]=v=>t.description=v),label:"Role description",error:a.description},null,8,["modelValue","error"]),e("div",Ve,[e("div",Ee,[d(P,{modelValue:p.value,"onUpdate:modelValue":s[2]||(s[2]=v=>p.value=v),type:"email",inputmode:"email",label:"Add Email (Optional)",class:"",error:a.email},null,8,["modelValue","error"])]),d(z,{onClick:F,disabled:p.value.trim()==""},{default:E(()=>[I("Add More")]),_:1},8,["disabled"])]),t.email?(o(),i("div",Me,[(o(!0),i(L,null,j(t.email,(v,O)=>(o(),i("div",{key:`user-${O}`,class:"flex items-center gap-2 py-1 px-2 border border-[#E7E8E7] bg-[#F2F1F1] rounded-lg"},[e("div",Ie,[e("span",Le,h(v.charAt(0).toUpperCase()),1)]),e("div",qe,[I(h(v)+" ",1),e("i",{onClick:H=>x(v),class:"pi pi-minus-circle text-sm text-secondary cursor-pointer"},null,8,Be)])]))),128))])):q("",!0),e("div",Ne,[Oe,e("div",Se,[(o(!0),i(L,null,j($,(v,O)=>(o(),i("div",{key:`privileges-${O}`,class:"flex items-center gap-4 text-sm text-dark-700"},[d(ee,{modelValue:t.privileges,"onUpdate:modelValue":s[3]||(s[3]=H=>t.privileges=H),value:v,inputId:O},null,8,["modelValue","value","inputId"]),e("span",null,h(O),1)]))),128))])]),je,De,e("div",Te,[d(z,{onClick:s[4]||(s[4]=v=>n.$emit("close")),variant:"outlined",block:""},{default:E(()=>[I("Cancel")]),_:1}),d(z,{loading:m.value,type:"submit",block:""},{default:E(()=>[I("Submit")]),_:1},8,["loading"])])],40,Fe)])]),_:1})):q("",!0),k.value?(o(),S(se,{key:1,persistence:!1,onClose:s[6]||(s[6]=v=>k.value=!1),caption:`${g.type.toLowerCase()=="create"?"Created":"Updated"} Successful`},null,8,["caption"])):q("",!0)],64)}}},Ue={class:"flex items-center justify-between"},Pe=e("h2",{class:"text-xl"},"Roles & Permissions",-1),ze=e("span",{class:"flex gap-2 items-center"},[e("i",{class:"pi pi-plus"}),I(" Create New Role ")],-1),Ke={class:"flex gap-6 mt-5 border pl-4 py-4 rounded-2xl"},He={class:"w-52 lg:w-56 flex-shrink-0"},We={class:"grow border-l px-6 flex flex-col gap-6"},Ye={class:"flex items-center justify-between"},Ge={class:"text-xl text-primary sm:text-2xl capitalize"},Je={class:"text-sm py-2 text-dark-700"},Qe={class:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6 mt-2"},Xe={class:"grid grid-cols-2 gap-4"},st={__name:"Index",setup(g){const C=U(),r=D(),{query:R,mutate:c}=r,b=Z(),A=y(!1),l=y(!1),f=y(!1),m=y(!1),k=y(!1),$=y(!1),p=w(()=>r.getAllRoles),t=w(()=>p.value&&p.value.find(x=>x._id===C.query.id)),a=y(!1),M=w(()=>[{title:"Edit",icon:ne,action(){l.value=!0,a.value=!1}},{title:"Remove",icon:ie,action(){f.value=!0,a.value=!1}}]),B=async()=>{k.value=!0,console.log(t.value._id);try{const x=await c({endpoint:"DeleteRole",data:{input:{roleId:t.value._id}}});console.log(x),k.value=!1,f.value=!1,x.success?(await F(),m.value=!0,setTimeout(()=>{m.value=!1},3e3)):b.error(x.message)}catch(x){k.value=!1,console.log(x.message)}},F=async()=>{try{$.value=!0,await R({endpoint:"ListRoles",storeKey:"listRoles"}),$.value=!1}catch(x){$.value=!1,console.log(x.message)}};return F(),(x,u)=>{const N=V("easiButton"),T=V("easiAlert"),n=V("easiLoader");return o(),i(L,null,[e("div",Ue,[Pe,d(N,{onClick:u[0]||(u[0]=s=>A.value=!0)},{default:E(()=>[ze]),_:1})]),e("div",Ke,[e("div",He,[d(me)]),e("div",We,[e("div",null,[e("div",Ye,[e("h4",Ge,h(_(t)&&_(t).title),1),d(ae,{isOpen:a.value,onOpen:u[1]||(u[1]=s=>a.value=!0),onClose:u[2]||(u[2]=s=>a.value=!1),menuItems:_(M)},null,8,["isOpen","menuItems"])]),e("span",Je,h(_(t)&&_(t).description?_(t).description:"N/A"),1)]),d(he),e("div",Qe,[d(W),d(W,{hasAccess:!1})])])]),f.value?(o(),S(T,{key:0,onClose:u[4]||(u[4]=s=>f.value=!1),icon:_(re),title:"Delete Role",caption:"Are you sure you want to delete this role? However this action will not be reversible once taken."},{default:E(()=>[e("div",Xe,[d(N,{onClick:u[3]||(u[3]=s=>f.value=!1),block:"",variant:"outlined"},{default:E(()=>[I("Cancel")]),_:1}),d(N,{loading:k.value,onClick:B,block:""},{default:E(()=>[I("Yes")]),_:1},8,["loading"])])]),_:1},8,["icon"])):q("",!0),m.value?(o(),S(T,{key:1,persistence:!1,onClose:u[5]||(u[5]=s=>m.value=!1),caption:"You have successfully removed this role"})):q("",!0),d(Y,{isOpen:A.value,onClose:u[6]||(u[6]=s=>A.value=!1)},null,8,["isOpen"]),d(Y,{isOpen:l.value,onClose:u[7]||(u[7]=s=>l.value=!1),type:"edit",role:_(t)},null,8,["isOpen","role"]),$.value?(o(),S(n,{key:2})):q("",!0)],64)}}};export{st as default};
//# sourceMappingURL=Index-d160e150.js.map
